---
title: SaaS製品向け課金API
url: https://woocommerce.com/document/billing-api-for-saas-products/
---

Woo MarketplaceのBilling APIを使用すると、Woo MarketplaceでSaaSアプリのサブスクリプションを販売できます。Woo MarketplaceのBilling APIは、定期支払い、無料トライアル、アップグレード、ダウングレード、そして1回限りの支払いをサポートしています。

このガイドに従って、WooCommerce の世界クラスの課金システムを活用し、Woo Marketplace に掲載しましょう。Billing API を既存のサインアップおよび購入フローに統合したり、WooCommerce.com からの顧客向けに特別なエクスペリエンスを提供したりできます。

WooCommerce Billing を SaaS アプリに統合するには、サンドボックスと API リファレンスが必要です。API フローについては以下で説明します。

まずは、WooCommerce Marketplace に[製品を送信](https://woocommerce.com/document/submitting-your-product-to-the-woo-marketplace/)してください。製品の詳細を記入し、アプリへの接続に WordPress プラグインを使用しているかどうかをテストするための zip ファイルをアップロードしてください。サンドボックスへのアクセスを許可する前に、製品が適切かどうかを審査いたします。

SaaS Billing APIとの連携は、本番環境で利用する前に、サンドボックス内で実装およびテストする必要があります。本番環境とサンドボックス環境の違いは、ドメイン（sandbox.woocommerce.com）とAPI認証情報です。サンドボックス環境から本番環境への移行は、ドメイン名、APIキー、シークレットを変更するだけで済みます。

**サンドボックス ドメイン:** https://sandbox.woocommerce.com/ **サンドボックス上の API のベース URL:** https://sandbox.woocommerce.com/wp-json/wccom/billing/1.0/

ローカルで開発する際には、考慮すべき点がいくつかあります。

1. `return_url` APIパラメータは、`localhost`を値として受け入れません。localhostのIPアドレスを`hosts`ファイル内のドメインにマッピングし、代わりに使用できます。例: `127.0.0.1 app.local`
2. Webhook呼び出しがアプリにアクセスするには、アプリがパブリックアクセス可能である必要があります。ngrok.comなどのサービスを使用してアプリをインターネットに公開する方法もあります。この場合、`hosts`ファイルのマッピングは必要ありません。代わりに、生成されたパブリックURLを使用します。

ビジネスレビューで承認されると、サンドボックス上にアプリを作成し、連携を完了します。このサンドボックスのベンダーアカウントから、SaaSアプリケーションの設定を確認・編集できます。設定が完了すると、ベンダーダッシュボードにログインしてSaaSアプリケーションの設定にアクセスできるようになります。

**SaaS アプリ** に移動して、アプリケーションの一覧を表示します。おそらく、アプリケーションは 1 つだけでしょう。

アプリケーションの設定にアクセスするには、APIキーをクリックしてください。設定ページでは、APIキーとシークレットの確認とコピー、新しいAPIキーとシークレットのペアの生成、アプリケーションに関連付けられたWebhook URLの追加、編集、削除を行うことができます。

**API リファレンスドキュメント:** [https://woocommercecomsaasbillingapi.docs.apiary.io/](https://woocommercecomsaasbillingapi.docs.apiary.io/)

上記のドキュメントリンクからOpenAPI仕様ファイルをダウンロードし、この標準をサポートするあらゆるツールで使用できます。例えば、Postmanにインポートすれば、すぐに使えるリクエストコレクションを作成できます。

リファレンスドキュメント内のすべてのパスはベースURLからの相対パスであることにご注意ください。例えば、`/subscriptions`エンドポイントは、完全なURLである`https://woocommerce.com/wp-json/wccom/billing/1.0/subscriptions`に解決されます。

各ベンダーアプリケーションには、オンボーディング時に認証情報（APIキーとシークレット）が発行されます。APIリクエストを認証するには、[Basic](https://tools.ietf.org/html/rfc7617)認証方式を使用し、リクエストに以下のHTTPヘッダーを渡す必要があります。

`認証: 基本的な base64encode(api_key:api_secret)`

以下は、プラン購入を開始するための /subscriptions エンドポイントへの POST リクエストの例です (ENCODED_KEY_SECRET_STRING を独自の秘密鍵に置き換えてください)。

```
curl --request POST \
  --url https://sandbox.woocommerce.com/wp-json/wccom/billing/1.0/subscriptions \
  --header 'Authorization: Basic ENCODED_KEY_SECRET_STRING' \
  --header 'Content-Type: application/json' \
  --data '{"name": "test plan", "price": 199.99, "billing_period": "year", "billing_interval": 1, "return_url": "https://example.com"}'
```

WooCommerce.com の課金システムとの連携は、SaaS 製品をマーケットプレイスに掲載する前に技術レビューを受けます。WooCommerce.com サンドボックスとの連携が完了しましたら、テスト用のリンクをお送りください。すべて正常に動作していることを確認いたします。実際の環境である必要はありませんが、テクニカルチームがレビューのためにアクセスできる動作確認済みの環境をご提供ください。

販売者は、SaaS プランのアクティブなサブスクリプションを取得するために、契約サインアップフローを実行する必要があります。

ウェブサイト上のリンク経由、または Woo マーケットプレイスから、販売者はリンクをたどって有料 SaaS プランを購入します。

その後、顧客は WooCommerce.com に誘導され、購入代金を支払います。

購入前に、顧客にアカウント登録をしてもらうと便利です。登録したアカウントは、確認後、SaaSアプリ内で有料購入にリンクできます。

WooCommerce.com からの顧客が他の顧客と区別されていることを確認してください。これらの顧客が利用できる支払い方法は、WooCommerce.com の請求システムのみです。

アプリケーションで利用可能なプランが複数ある場合は、購入を開始する前に販売者に 1 つのプランを選択してもらうことができます。

次のステップで説明するように、販売者に何も見せずにすぐに購入を開始することもできます。

サブスクリプションプランの情報を指定して、**WooCommerce.com の Billing API への API 呼び出し** を実行してください。レスポンスで**確認 URL** が返されます。

一般的な[サブスクリプションプラン情報](https://woocommercecomsaasbillingapi.docs.apiary.io/#reference/0/subscriptions/post)には以下が含まれます。

- プラン名
- 価格
- 請求期間
- 請求間隔
- 試用期間（任意）
- 試用期間（任意）
- 戻りURL

**リターン URL** は、WooCommerce.com で購入を完了した後に販売者をリダイレクトするアプリケーション内の URL です。

**確認URL**はWooCommerce.com上で固有のものです。アプリケーションは、販売者をこのURLにリダイレクトし、サブスクリプションの確認と支払いを行う必要があります。

応答には、UUID 形式の一意のサブスクリプション契約 ID も含まれており、これを使用して、システム内のサブスクリプションをアプリケーションの内部顧客 ID に関連付けることができます。

顧客がアプリケーションにアクセスした瞬間に購入手続きを開始し、同じリクエスト内でWooCommerce.comの確認URLにリダイレクトすれば、処理は数秒以内に完了します。販売者にとって、まるでWooCommerce.comを離れたことがないかのようなシームレスな体験を提供します。

アプリケーションは販売者をWooCommerce.comの確認URLにリダイレクトし、そこでサブスクリプションの確認と支払いを行います。販売者は、WooCommerce.comで以前に購入したことがある場合は、必要な支払い情報がすべて事前に入力されているため、使い慣れたチェックアウト手続きを踏むことができます。

**注:**アプリケーションは、ユーザーが「同意」し、WooCommerce.com でのチェックアウトフロー全体を完了した後にのみ、購入を成功と関連付ける必要があります。アプリケーションは、購入フロー中の中断（アプリのクラッシュ、接続の切断、停電など）を考慮する必要があります。これには、ユーザーが WooCommerce.com のチェックアウトにリダイレクトされ、購入を確定せずにアプリケーションに戻る場合も含まれます。ユーザーが WooCommerce.com で購入を確定するまで、アプリケーションはプラン情報を更新してはなりません。

加盟店が購入を確認し完了すると、開始ステップで指定した**リターンURL**にリダイレクトされます。加盟店をまだ登録していない場合は、このフェーズで登録できます。リターンURLは`GET`パラメータで`契約ID`を渡すので、これを社内の顧客IDと関連付けることができます。

WooCommerce.com は、**Webhook URL** に `saas_billing_contract.activated` トピックを指定した Webhook 呼び出しを実行します。これは、契約が確認され、支払いが成功したことを通知します。

当社の課金システムは、オプションで無料トライアルをサポートしています。無料トライアルは、販売者が購入前にサービスが自社に適しているかどうかを確認できるため、返金やキャンセルの件数を削減するのに役立ちます。トライアル期間は、サブスクリプション登録の開始段階で指定できます。最初のAPI呼び出し時に、`trial_period` および `trial_length` パラメータを渡してください。

試用期間終了時に、販売者がサブスクリプションをキャンセルしなかった場合、自動的にサブスクリプション料金が請求されます。「saas_billing_contract.renewed」トピックと契約の詳細を含むWebhook呼び出しが送信されます。詳細はWebhookセクションをご覧ください。

Billing APIは、サブスクリプションのアップグレード、ダウングレード、クロスグレードをサポートしています。この機能を使用すると、課金間隔（例：月払いから年払い）を変更したり、1日あたりの料金が高い、安い、または同等のサブスクリプションに切り替えたりできます。

#### 1. スイッチを開始する

`POST /subscriptions/{contractID}`エンドポイントを使用して、サブスクリプションの切り替えを開始します。APIドキュメントに記載されている必要な情報をすべて提供してください。レスポンスには`confirmation_url`パラメータが含まれます。加盟店をこのURLにリダイレクトして、切り替えの確認と按分された金額のお支払いを行ってください。詳細はAPIドキュメントをご覧ください。

#### 2. 加盟店が切り替えを確認する

販売者はWooCommerce.comにアクセスし、切り替えを確認します。日割り計算による料金が発生する場合、または前の手順で日割り計算による料金が既に支払われている場合は、切り替えを完了するために料金を支払う必要があります。新しいサブスクリプションの方が安い場合（ダウングレード）、サブスクリプションを延長することで差額が返金されます。

#### 3. 加盟店があなたのアプリケーションにリダイレクトされます

加盟店が切り替えを確認すると、WooCommerce.com でサブスクリプションが更新され、開始フェーズで指定したリターン URL にリダイレクトされます。この URL には、契約 ID が GET パラメータとして追加されます。このタイミングで、システム側でもサブスクリプションを更新してください。WooCommerce.com は、`saas_billing_contract.updated` トピックを使用して、Webhook URL へのサーバー間呼び出しも実行します。Webhook リクエストボディには、契約オブジェクトが含まれます。詳細は Webhook セクションをご覧ください。

Billing API は、古いサブスクリプションと新しいサブスクリプションの 1 日あたりのコストを確認して、**次の支払い日**を自動的に調整し、**比例配分された料金**を請求します。

#### ダウングレード

システムは、**次回支払日**を延期することで、加盟店に前払い金額を補償します。以前のサブスクリプションの1日あたりの料金に、現在の請求サイクルの残り日数を掛け合わせた金額が、新しいサブスクリプションの1日あたりの料金で可能な限り多くの日数をカバーできるように使用されます。加盟店は、サブスクリプションをダウングレードする際に日割り計算による手数料を支払う必要はありません。

**例**

ある販売業者が1月1日に**年間100ドル**のサブスクリプションを購入しました。請求サイクルの2ヶ月後に**月額6ドル**のサブスクリプションにダウングレードしました。その結果、システムによって次回の支払日が翌年の4月19日に延期されました。

旧サブスクリプションの1日あたりの料金 -> 0.27ドル/日 (100ドル/365日)

新しいサブスクリプションの1日あたりの価格 -> 0.2ドル/日（6ドル/30日）

旧プランで費やした合計日数 -> 59 日 ( 1 月 31 日 + 2 月 28 日 )

旧プランの残り日数 -> 306 ( 365 – 59 )

プリペイドクレジット残高合計 -> $82.62 ( 残り 306 日 * $0.27/日 )

新しいプランのクレジットがカバーできる日数 -> 414 日 ( $82.62 / $0.2 = 413.1 を 414 に切り上げ)

次回支払日 -> 2023年4月19日 (3月1日 + 414日)

#### クロスグレード

これは最も理解しやすいタイプの切り替えです。この場合、1日あたりの料金は変わりません。システムによって次回の支払日が変更されたり、日割り料金が請求されたりすることもありません。

**例**

加盟店が**月額10ドル**のサブスクリプションから**年額120ドル**のサブスクリプションに切り替えます（またはその逆）。1日あたりの料金は**0.33ドル**のままです。前払い期間が終了すると、翌年のサブスクリプションは120ドルで更新されます。

#### 請求サイクルが短いサブスクリプションにアップグレードする

より短い請求サイクルのサブスクリプションにアップグレードする場合、システムでは加盟店に日割り手数料は請求されません。以前の請求サイクルで経過した日数に応じて、次回の支払日がアップグレード日に近づきます。次回の支払日は、アップグレード日と同日になる場合もあります。

**例**

ある販売業者が**月額10ドル**のサブスクリプションに加入しました。請求サイクルの**12日**後、**週7ドル**のサブスクリプションにアップグレードしました。新しいサブスクリプションの請求サイクルは短くなるため、日割り料金は発生しません。

システムは次回の支払日を調整します。以前の請求サイクルで経過した日数**12**に、新しい1日あたりのサブスクリプション価格**$1**を乗算します。その結果得られる金額**$12**は、新しいサブスクリプション価格**$7**よりも高くなります。そのため、システムは販売者に更新料**$7**を請求し、次回の支払日を1週間後に設定しました。金額が新しいサブスクリプション価格と同額の場合も同様です。

金額が低い場合は、アップグレード日から計算して、その結果生じた金額でカバーされる日数だけ更新日を延長することで、差額を補填します。

#### 同等以上の請求サイクルを持つサブスクリプションにアップグレードする

加盟店が以前のサブスクリプションと同等かそれより長い請求サイクルのサブスクリプションにアップグレードする場合、システムは日割り料金を請求します。日割り料金は、現在のサブスクリプションの請求サイクルの残り日数と、2つのサブスクリプション間の日当たり料金の差額を乗じて算出されます。この場合、次回の支払日は変更されません。

**例**

販売者は**月額10ドル**のサブスクリプションに加入します。請求サイクルの**15日**後、**年額150ドル**のサブスクリプションにアップグレードします。この場合、請求サイクルが長くなるため、日割り計算による料金が発生します。古いサブスクリプションと新しいサブスクリプションの1日あたりの料金は、それぞれ約0.33ドルと0.41ドルです。両者の価格差は1日あたり0.08ドルです。現在の請求サイクルは15日残っているため、システムは0.08ドル×15日の日割り計算料金を請求し、結果として**1.2ドル**のアップグレード料金が発生します。サブスクリプションは15日後に年額150ドルで更新されます。

Billing APIは、1回限りの課金もサポートしています。この機能は、更新できないサービスに対して加盟店に課金するために使用できます。例えば、メール配信サービスを提供していて、プロモーション期間中や追加の特典が必要な際に顧客にクレジットパックを提供したいとします。これらのクレジットパックは継続的な課金は発生せず、必要に応じて購入できます。一般的な1回限りの課金フローは、サブスクリプション登録フローと非常に似ており、以下に説明します。

`POST /charges`エンドポイントを呼び出して課金を開始します。APIドキュメントに記載されている必要な情報を入力してください。レスポンスには`confirmation_url`が含まれます。加盟店をこのURLにリダイレクトしてください。詳細はAPIドキュメントをご覧ください。

販売者はWooCommerce.comにアクセスし、請求内容を確認します。支払いが完了すると、開始フェーズで指定したリターンURLにリダイレクトされます。

販売者はリターンURL経由であなたのサイトへリダイレクトされます。このURLには、課金契約IDがGETパラメータとして追加されます。このタイミングで、販売者が支払った商品をアカウントに追加してください。WooCommerce.comは、`saas_billing_contract. activated`トピックを使用して、あなたのWebhook URLへのサーバー間呼び出しも行います。Webhookリクエストボディには、課金オブジェクトが含まれます。詳細はWebhookセクションをご覧ください。

WooCommerce.com は更新を自動で処理します。マーケットプレイスで販売される他のすべての製品と同様に、販売者にとって手間のかからないエクスペリエンスを提供します。

アプリケーションは自動更新に対応している必要があります。更新を実行するために、加盟店側で手動操作を行う必要がないことを確認してください。

更新に関する通知を受け取るには、Webhookシステムをご利用ください。更新が成功した場合も失敗した場合も、同様に通知いたします。更新に失敗した場合は、サブスクリプションを一時停止状態にし、お客様に通知いたします。その後数日以内に再度更新を試み、成功した場合はお客様に通知いたします。期限切れのサブスクリプションは削除されません。期限切れのサブスクリプションは、お客様のご判断でキャンセルしていただけます。

WooCommerce.com は、更新前と更新当日に販売者様にメールをお送りします。お客様ご自身でも、更新に関するご連絡を販売者にお送りいただけます。

加盟店は、以下のすべての種類のSaaS請求注文について払い戻しをリクエストできます。払い戻しをリクエストできる日数に制限はありません。

1. サブスクリプション契約の申し込み
2. サブスクリプションプランのアップグレード
3. サブスクリプションの更新
4. 1回限りの課金

ベンダーの皆様には、SaaS製品への返金リクエストがあった場合、メール通知が届きます。保留中の返金リクエストはすべて、ベンダーダッシュボードの「SaaSアプリ」→「保留中の返金」ページでご確認いただけます。

各リクエストを確認し、返金リクエストの理由について販売者に問い合わせた上で、最終的にリクエストを承認するか拒否するかを決定できます。返金リクエストを拒否する場合は、理由を明記してください。

SaaS 請求注文の払い戻しリクエストを承認すると、基礎となる SaaS 契約もキャンセルされます。

WooCommerce.com は、`saas_billing_contract.refunded` および `saas_billing_contract.canceled` トピックを使用して、Webhook URL へのサーバー間呼び出しも行います。Webhook リクエストボディには、contract オブジェクトが含まれます。詳細は Webhook セクションをご覧ください。

加盟店はアプリケーションからサブスクリプションをキャンセルできる必要がありますので、その機能が実装されていることを確認してください。契約をキャンセルするための専用のエンドポイントがHTTP APIに用意されています。`DELETE`エンドポイントについては、APIドキュメントをご覧ください。

販売者がサブスクリプションをキャンセルする場合、前払い期間の終了まで現在のプランのメリットを享受できることが期待されます。

例えば、年間サブスクリプションを3ヶ月後にキャンセルした場合、加盟店は残りの9ヶ月間、お客様のサービスをご利用いただけます。サブスクリプションのキャンセル後、お客様のアプリケーションで加盟店アカウントをどのように扱うかは、お客様次第です。

サブスクリプションのライフサイクルにおける重要なイベントについて、アプリケーションに通知を送信します。イベントは以下のとおりです。これらのイベントには、リクエスト本文に常にコントラクトのスナップショットが含まれており、呼び出し時のコントラクトの状態を反映しています。

Webhook 呼び出しは、応答として成功を示す HTTP コードが返されることを期待します。そうでない場合、配信は失敗したとみなされます。再試行システムにより、Webhook エンドポイントへの呼び出しが最大 5 回試行され、再試行間の待機時間が長くなります。Webhook エンドポイントの監視を必ず実施してください。一部のコントラクトイベントの更新情報を取得するには、これ以外の方法はありません。一般的なリクエストボディのペイロードは次のようになります。

```
// example of a subscription contract
{
  "subscription":{
    "id":"4733be9c-8d6c-4a78-a4f8-268a64770985",
    "status":"active",
    "next_payment_date":"2022-08-24 14:13:42",
    "end_date":null,
    "billing_intents":[
      {
        "id":1,
        "status":"completed",
        "payload":{},
        "created_at":"2022-06-24 14:13:35",
        "updated_at":"2022-06-24 14:14:06"
      }
    ],
    "transactions":[
      {
        "id":1,
        "billing_intent_id":1,
        "created_at":"2022-06-24 14:13:42",
        "completed_at":"2022-06-24 14:14:03",
        "amount":89.5,
        "amount_refunded":0,
        "url":"https://woocommerce.com/my-account/view-order/172"
      },
      {
        "id":2,
        "billing_intent_id":1,
        "created_at":"2022-07-24 14:13:42",
        "completed_at":"2022-07-24 14:14:23",
        "amount":89.5,
        "amount_refunded":0,
        "url":"https://woocommerce.com/my-account/view-order/179"
      }
    ]
  }
}

// example of a one-time charge contract
{
  "charge":{
    "id":"68f28fbe-8510-4369-8f80-c5a5380c85db",
    "status":"active",
    "billing_intents":[
      {
        "id":1,
        "status":"completed",
        "payload":{},
        "created_at":"2022-07-01 10:21:24",
        "updated_at":"2022-07-01 10:22:39"
      }
    ],
    "transactions":[
      {
        "id":1,
        "billing_intent_id":1,
        "created_at":"2022-07-01 10:21:31",
        "completed_at":"2022-07-01 10:22:39",
        "amount":89.5,
        "amount_refunded":0,
        "url":"https://woocommerce.com/my-account/view-order/199"
      }
    ]
  }
}
```

ご覧のとおり、Webhook経由では加盟店情報を共有しません。Webhookは主に、契約期間中の様々な変更についてベンダーであるお客様に通知するために使用されます。リクエストペイロードには、契約ID、ステータス、および請求インテントが含まれます。Webhook呼び出しをトリガーするイベントはトピックとして配信され、`x-wc-webhook-topic`リクエストヘッダーで確認できます。

現在利用可能なトピックは次のとおりです。

- `saas_billing_contract.activated` – このイベントは、加盟店がサブスクリプションまたはワンタイム課金でチェックアウトを完了したことを示します。これは、契約が支払い済みで「アクティブ」であることを示します。このイベントを使用して、プランまたは機能を有効化できます。
- `saas_billing_contract.updated` – このイベントはサブスクリプションに固有です。加盟店がプランのアップグレードまたはダウングレードを確認し、按分された金額（該当する場合）を支払ったときに発生します。契約ステータスは「アクティブ」です。このイベントを使用して、システム内のプランを更新できます。
- `saas_billing_contract.renewed` – このイベントはサブスクリプションに固有で、サブスクリプションの更新が正常に完了したときに発生します。このイベントは、加盟店に更新金額が正常に請求されたことを示します。契約ステータスは「アクティブ」です。
- `saas_billing_contract.paused` – このイベントはサブスクリプションに固有で、サブスクリプション契約のステータスが「一時停止」になったときに発生します。これは、更新期限が迫っているにもかかわらず、何らかの理由で処理できなかった場合に発生します。通常は支払い方法の問題が原因です。ただし、更新を再試行するシステムを備えています。サブスクリプションは最終的に支払いが完了し、`renewed` イベントがトリガーされます。期限切れの場合は `canceled` イベントがトリガーされます。必要に応じて、このイベントを使用して顧客に連絡を取ることができます。
- `saas_billing_contract.canceled` – このイベントは、サブスクリプションまたは1回限りの請求がキャンセルされたときに呼び出されます。プリペイド期間の終了日に基づいて、加盟店のプランまたは機能を無効化するために使用します。請求は、加盟店が承認する前のみキャンセルできます。ベンダーは、APIドキュメントに記載されている対応する `DELETE` 呼び出しを使用して契約をキャンセルできます。契約をキャンセルした場合、顧客はプリペイド期間の終了までプランを引き続き使用できます。日付は、Webhook呼び出しの本文に含まれる契約ペイロードに含まれています。ご安心ください。前払い期間が終了すると、フォローアップイベントが送信されます。Webhook呼び出しに含まれる契約または請求のステータスは「キャンセル済み」になります。
- `saas_billing_contract.prepaid_term_ended` – このフォローアップイベントは、キャンセルされた契約の前払い期間に達したときに発行されます。このイベントを使用して、加盟店のプランまたは機能を無効化できます。
- `saas_billing_contract.refunded` – このイベントは、サブスクリプションまたは1回限りの請求が払い戻されたときに発行されます。払い戻された金額は、最新のトランザクションの `amount_refunded` フィールド（サブスクリプションまたは1回限りの請求の `transactions` プロパティ）で確認できます。

リクエストボディのペイロードはAPIシークレットで署名されており、署名は`X-WC-Webhook-Signature`リクエストヘッダーに含まれています。この署名を使用することで、ペイロードの整合性を確認できます。

検証を行う PHP コードの例:

```
$api_secret = 'YOUR_SECRET';
$payload = file_get_contents( 'php://input' );
$provided_signature = $_SERVER['HTTP_X_WC_WEBHOOK_SIGNATURE'] ?? '';
$valid_signature = base64_encode( hash_hmac( 'sha256', $payload, $api_secret, true ) );

if (hash_equals($valid_signature, $provided_signature)) {
    $request_origin_confirmed = true;
} else {
    $request_origin_confirmed = false;
}
```

Webhook通知を有効にするには、アプリケーション内でWebhookリクエストを受け入れるURLを指定する必要があります。このURLは、認証やIPアドレスのホワイトリスト登録なしで、パブリックにアクセスできる必要があります。現在、アプリケーションごとに1つのWebhookエンドポイントをサポートしています。アプリケーションのWebhook URLは、SaaSアプリケーション設定で追加、更新、削除できます。

このツールは、統合ステップを支援するためにサンドボックスでのみ利用可能です。決済、ユーザーとのコミュニケーション、サブスクリプションステータスなどに副作用があるため、本番環境ではご利用いただけません。このツールは、ベンダーの皆様がWebhookの統合を簡単かつ繰り返しテストできるようにするためのものです。

[Webhook テスト ツール](https://sandbox.woocommerce.com/wp-admin/admin.php?page=saas-billing-webhooks) を使用するには、sandbox.woocommerce.com のベンダー ダッシュボードにログインし、**SaaS アプリ** > **Webhooks** に移動します。

フォームにWebhook呼び出しをテストする任意の契約UUIDを入力し、Enterキーを押すか、**テスト用に選択**をクリックします。ページがリロードされ、契約が選択された状態になります。ページ上の適切なイベントボタンをクリックすると、選択した契約のWebhook呼び出しをトリガーできます。利用可能なイベントは現在の契約ステータスによって異なりますのでご注意ください。Webhook呼び出しは非同期でトリガーされるため、呼び出しを受信するまでに最大1分かかる場合があります。利用可能なWebhookイベントの詳細については、このドキュメントの[Webhookセクション](https://woocommerce.com/document/billing-api-for-saas-products/#section-22)をご覧ください。[SaaSアプリケーション設定](https://woocommerce.com/document/billing-api-for-saas-products/#saas-application-settings)でWebhook URLが設定されていることを確認してください。

現時点では対応しておりません。現在は米ドルのみに対応しています。ユーロやポンドなどの通貨の追加も検討していますが、時期は未定です。

加盟店の現地規制を遵守するため、元の価格に税金を加算させていただきます。税額は加盟店の居住国によって異なり、自動的に計算されます。アプリにこの旨の通知を追加することで、加盟店に税金の影響で合計金額が異なる可能性があることをお知らせいただけます。

販売者がWooCommerce.comにアクセスし、請求情報を送信する前に、確実に税金を計算する方法はありません。税金の計算は多くの要素によって決まります。そのため、請求先住所、IPアドレス、検証済みのVAT IDなど、必要なすべてのデータを事前に入手しなければ、正確な予測を行うことは不可能です。

いいえ、メールアドレス、氏名、住所などの個人情報をベンダーアプリケーションと共有することはありません。お客様にも共有していただく必要はありません。フローは個人情報を交換することなく機能するように設計されています。そのため、販売業者から個人データを取得する必要がある場合は、サインアップ時にリクエストすることができます。

購入完了後に販売者がリダイレクトされるリターンURLに付加される固有の契約IDを使用して、これらをマッピングできます。課金APIとWebhookもこのIDを使用してサブスクリプションを識別します。販売者と購入をマッピングするために個人情報を使用する必要はありません。

はい。マルチサイトプランをご購入いただけます。現在の請求APIでは、数量パラメータの設定はサポートされていません。ただし、マルチサイト機能を契約に組み込んで、マルチサイトサブスクリプションを提供することは可能です。契約IDとストアIDを組み合わせて、社内で使用状況を追跡できます。

WooCommerce.comマーケットプレイスに掲載することで、ソフトウェアベンダーは数百万人の登録ユーザーという幅広いオーディエンスに自社製品を提供できるようになります。他のマーケットプレイスと同様に、製品を掲載するにはいくつかのガイドラインと要件に従う必要があります。これにより、顧客全体の品質とエクスペリエンスが向上し、ソフトウェアベンダーから直接購入するのではなく、WooCommerce.comを通じて購入していただく可能性が高まります。

これらの要件はすべての顧客に適用されるわけではなく、WooCommerce.com からの顧客にのみ適用されます。既存の顧客ベース、またはマーケットプレイス以外のソースからの顧客には、現在の課金システムとフローをそのままご利用いただけます。

API 経由で契約のサインアップを開始する場合、POST `/subscriptions`[リクエスト](https://woocommercecomsaasbillingapi.docs.apiary.io/#reference/0/subscriptions) を送信するときに、`price` パラメータで下限額を指定して価格を設定できます。

- **ベンダー** – WooCommerce.com と提携し、WooCommerce.com マーケットプレイスを通じてソリューションを販売する SaaS サービスプロバイダー。
- **ベンダーアプリケーション (アプリケーション)** – ベンダーのアプリケーションは Billing API と統合され、WooCommerce.com と通信します。
- **販売者** – SaaS 製品を購入する WooCommerce.com ユーザー。
- **サブスクリプションプラン (プラン)** – サブスクリプション製品。
- **サブスクリプション契約 (契約)** – SaaS ベンダーが提供するサービスと引き換えに、販売者が支払い方法に定期的に請求することに同意する契約。
- **1 回限りの請求 (請求)** – 1 回限り（更新不可）の請求。
- **契約のサインアップ** – サブスクリプション契約または請求契約を作成し、販売者の承認を得る。

