---
title: 注文属性追跡
url: https://woocommerce.com/document/order-attribution-tracking/
---

注文アトリビューショントラッキングは、オンラインストアへの注文獲得につながったマーケティング活動、チャネル、キャンペーンを明確に把握したいストアオーナーのための機能です。この機能により、注文をトラフィックソースに紐付け、様々なマーケティング活動の効果を把握することができます。

この機能を使えば、オンラインストアで顧客が購入に至ったきっかけを突き止めることができます。Googleの商品リスト、トレンドのTikTok動画、Facebookのシェアされた投稿、あるいは先週のメールキャンペーンなど、様々な要因が考えられます。

これらの質問への答えを知ることで、時間とお金の両方をどこに投資するかについて、より情報に基づいた決定を下すことができます。

この新機能は、広く採用され、多くのマーケティングプラットフォームやアトリビューションツールのデフォルトとなっている**ラストクリックアトリビューションモデル**を活用しています。このモデルでは、顧客がサイトにアクセスする前の最後のインタラクションにコンバージョンの貢献度を100%割り当てます。広告、メール、商品リストなど、クリックされた「最後のもの」がコンバージョンの貢献度として完全に認識されます。

注文が行われない限り WooCommerce にはデータが保存されず、この機能のすべての Cookie はセッションごとに期限切れになるため、この機能を使用してセッション間で訪問者を追跡することはできません。

注文属性の追跡を管理する基本的なルールは次のとおりです。

- **UTMとオーガニックソースが優先されます:** [UTM](https://en.wikipedia.org/wiki/UTM_parameters)とオーガニックソースは、常に以前のソースを上書きします。
- **タイプイン（直接）は上書きされません:** 直接訪問（タイプイン）は、以前に特定されたソースを上書きすることはありません。
- **参照元ソースの階層:** 参照元ソースは、現在アクティブな訪問者セッションがない場合のみ、以前のソースを上書きします。同じセッション内（例：同じブラウザでの最初のサイト訪問から30分以内）の場合、参照元ソースは以前のソースを上書きしません。

この機能を有効（または無効）にするには、**WooCommerce > 設定 > 詳細 > 機能 > 注文属性** に移動します。

注文アトリビューションデータが入力できるようになりましたので、そのデータを分析し、実用的なインサイトを引き出す方法をご説明いたします。**WooCommerce Analytics**プラグインを使用して、サイトに追加できる新しい注文アトリビューションレポートをご用意しました。これにより、5つの新しいレポートが追加され、顧客が購入前に使用している主要なチャネル、ソース、さらにはデバイスを把握できるようになります。各レポートの詳細については、ドキュメントをご覧ください。

これらの新しいレポート以外にも、注文属性データは他の場所でも確認できます。各新規注文の注文編集ページには、「**注文属性**」と「顧客履歴」という2つのメタボックスがあります。これらのボックスでは、注文の発生源に関する詳細情報と、顧客とストアのやり取りの詳細な履歴を確認できます。これらのメタボックスには、以下の情報が表示されます。

- **注文のアトリビューション:** オリジン、ソースタイプ、[UTM](https://en.wikipedia.org/wiki/UTM_parameters) キャンペーン（ソースタイプが UTM の場合）、メディア、デバイスタイプ、セッションのページビュー。UTM [ソースプラットフォーム、クリエイティブフォーマット、マーケティング戦略](https://support.google.com/analytics/answer/10917952#parameters&zippy=%2Cin-this-article) パラメータもサポートされています。
- **顧客履歴:** 完了した注文数、返金された注文数、合計支出

**WooCommerce > 注文** テーブルに、注文元を表示する新しい列が追加されました。この列には各注文の注文元が表示され、どのチャネルが売上を伸ばしているかをすぐに把握できます。

**注記：**

注文属性追跡データは、この機能が有効になっているときに生成された注文にのみ適用されます。この機能をいつでも無効にした場合、無効期間中に行われた注文にはこのデータは含まれません。

注文属性追跡機能は、注文が行われると次の情報を保存します。

- **参照元:** 訪問者をサイトに誘導したサイトのURL。
- **UTMパラメータ:** 訪問者をサイトに誘導したURLに[UTM](https://en.wikipedia.org/wiki/UTM_parameters)パラメータが含まれている場合、これらのパラメータを解析し、ソース、メディア、キャンペーン、コンテンツ、キーワードのパラメータを保存します。
- **デバイスタイプ:** 顧客が注文時に使用したデバイスのタイプ（デスクトップ、タブレット、モバイル）。
- **セッションページビュー**: 注文前のセッションでのページビュー数。

注文属性機能では次の Cookie が使用されます。

紹介やソースを介さずに（つまり、ショップから直接）注文する場合、オリジンは常に「Direct」になります。様々なオリジンでテストを行うには、シークレットウィンドウ（プライベートウィンドウ）を使用して以下の手順に従ってください。

#### 紹介

- 任意のウェブサイトにアクセスし、開発者ツールでリンク「href」を編集してストアへのリンクを設定します。商品をカートに追加し、チェックアウトを完了します。

#### オーガニック

- https://www.google.com/ にアクセスし、デベロッパーツールでリンク「href」を編集してストアへのリンクを設定します。商品をカートに追加し、チェックアウトを完了します。

#### UTMパラメータの使用

- `https://yourstorename.com/shop/?utm_source=newsletter&utm_medium=email&utm_campaign=sale&utm_content=utmcontent&utm_term=utm_term` のような URL でストアを開きます。
- 商品をカートに追加し、チェックアウトを完了します。

#### 入力（直接）

- 上記と同じですが、パラメータはありません。

#### Web管理者

- [バックエンドから手動で注文を追加する](https://woocommerce.com/document/managing-orders/view-edit-or-add-an-order/#manually-adding-an-order)

＃＃＃＃ 未知

- [バックエンドから手動で注文を追加する](https://woocommerce.com/document/managing-orders/view-edit-or-add-an-order/#manually-adding-an-order)
- 次に、データベースから関連するメタデータを削除します。

```
DELETE FROM `wp_wc_orders_meta` WHERE `order_id` = 93 AND `meta_key` LIKE '_wc_order_attribution%';

DELETE FROM `wp_postmeta` WHERE `post_id` = 93 AND `meta_key` LIKE '_wc_order_attribution%';
```

このデータは、機能が有効になっている間に生成された注文にのみ適用されます。この機能をいつでも無効にした場合、無効期間中に行われた注文にはこのデータは含まれません。

はい。上記のCookieは訪問者のブラウザに保存されます。これらのCookieは、訪問者のセッションが終了するか、Cookie履歴が消去されると期限切れになります。

注文があった場合にのみ、これらの Cookie に保存されたデータにアクセスします。

デフォルトでは、顧客のセッションは30分間とみなされます。この機能によって設定されるCookieはセッションごとに有効期限が切れるため、複数のセッションにわたる訪問者の追跡やリマーケティングには使用できません。

一部のWebアプリケーションファイアウォールは、注文属性の取得に使用される訪問者情報のCookieを誤ってフラグ付けするルールセットを使用しており、訪問者に「403 Forbidden」エラーを表示します。この問題は、主要なルールセットプロバイダーによって認識されています。

- Comodo WAFルールセット – [更新されたルールセットがリリースされました](https://developer.woocommerce.com/2024/01/16/woocommerce-8-5-1-issues-with-web-application-firewalls-modsecurity/#comment-8554)。これにより、Cookieがホワイトリストに登録されます。WAFでこのルールセットを使用している場合は、最新バージョンに更新することで問題が解決するはずです。
- OWASPコアルールセット – [問題を認識しました](https://github.com/coreruleset/coreruleset/issues/3525#issuecomment-1922034226)。ただし、修正リリースの予定はありません。WAFでこのルールセットを使用している場合は、除外ルールを追加して問題を解決する必要があります。ルールは[この Github コメント](https://github.com/coreruleset/coreruleset/issues/3525#issuecomment-1922208950)で入手できます。

ルールセットを更新したり、除外ルールを追加したり、ホスティング プロバイダーに依頼したりすると、WAF の問題が解決されるはずです。

**WooCommerce 9.0 では、WAF の誤検知を回避するための新たな方法** として、`wc_order_attribution_use_base64_cookies` フィルターが導入されました。このフィルターを `true` に設定すると、[注文属性 Cookie](https://woocommerce.com/document/order-attribution-tracking/#section-7) でキャプチャされたデータに Base64 エンコードが使用され、過剰な WAF を誤検知する可能性のある部分文字列が回避されます。

```
add_filter( 'wc_order_attribution_use_base64_cookies', '__return_true' );
```

これらのオプションで WAF の問題が解決しない場合は、**WooCommerce > 設定 > 詳細 > 機能** で注文アトリビューション機能を完全に無効にするか、プログラムで以下を使用して無効にすることができます。

```
# PHP 
update_option( 'woocommerce_feature_order_attribution_enabled', 'no' );

# WP CLI
wp option update woocommerce_feature_order_attribution_enabled "no"
```

注文属性情報は、訪問者のブラウザのCookieを使用して一時的に保存されます。注文が発生した場合にのみ、このデータが読み取られ、注文メタデータとして保存されます。

訪問者のブラウザに保存されているCookieは、セッションごとに期限切れになります。WooCommerceの注文アトリビューション機能は、複数のセッションにわたる訪問者の追跡や、訪問者の行動プロファイルの集約には適していません。

はい、WooCommerce の注文アトリビューションは [WP Consent API](https://wordpress.org/plugins/wp-consent-api/) と互換性があり、同意管理プラットフォームとの便利な統合が可能になりました。

WooCommerceで以前に[データ共有](https://woocommerce.com/usage-tracking/)（Automatticとのデータ共有）にオプトインした場合、この機能で取得された統計的な注文属性データは、注文ごとにAutomatticと共有されます。メールアドレス、請求情報、配送情報などの顧客データは**送信されません**。

