---
title: 高性能注文ストレージ
url: https://woocommerce.com/document/high-performance-order-storage/
---

[高パフォーマンス注文ストレージ (HPOS)](https://woocommerce.com/posts/platform-update-high-performance-order-storage-for-woocommerce/) (旧称カスタム注文テーブル) は、e コマースのニーズに合わせて特別に設計されたソリューションであり、理解しやすい堅牢なデータベース構造を提供します。

Woo の作成、読み取り、更新、削除 (CRUD) 設計を使用して、WooCommerce クエリに最適化されたカスタム テーブルに注文データを保存し、ストアのパフォーマンスへの影響を最小限に抑えます。

HPOS を WooCommerce に導入すると、eコマース ストアに不可欠な 3 つの特性が改善されます。

1. **スケーラビリティ** 顧客数と注文数の増加は、ストアのデータベースへの負荷を増加させ、顧客の注文リクエストを処理し、シームレスなユーザーエクスペリエンスを提供することが困難になります。高性能注文ストレージを使用すると、注文、注文先住所、専用インデックスなどのデータに**専用テーブル**が用意されるため、読み取り/書き込み操作とビジー状態のテーブルが削減されます。この機能により、あらゆる形態と規模のeコマースストアは、専門家の介入を必要とせずに、ビジネスの可能性を最大限に引き出すことができます。
2. **信頼性** HPOSを使用すると、対象データのバックアップの実装と復元が簡単になります。これらのカスタム注文テーブルに信頼性の高いバックアップがあるため、注文、在庫数、顧客情報が失われる心配はもうありません。また、読み取り/書き込みロックの実装を容易にし、競合状態を防止します。
3. **シンプルさ** 基盤となるデータとWooCommerceエントリを見つけるために、単一の巨大なデータベースを調べる必要がなくなります。 HPOSを使用すると、`_posts`テーブルとは独立して、個別のテーブルと扱いやすいエントリを閲覧し、データを検索したり、テーブル構造を理解したりすることができます。また、新しい拡張機能の開発、ショップや商品のデザインの実装、WooCommerceのより柔軟な変更も可能になります。

バージョン 8.2 より前では、WooCommerce は注文情報を保存するために `_post` および `_postmeta` テーブル構造に依存していました。

HPOSは、注文、注文先住所、専用インデックスなどのデータ専用のテーブルを導入しました。これにより、読み取り/書き込み操作と使用頻度の高いテーブルが削減されます。この機能により、あらゆる形態や規模のeコマースストアが**最大限のポテンシャルを発揮**できるようになります。

注文データは、`_posts` および `_postmeta` テーブルから 4 つのカスタム注文テーブルに同期されます。

- `_wc_orders`
- `_wc_order_addresses`
- `_wc_order_operational_data`
- `_wc_orders_meta`

**注記：**

高性能注文ストレージを有効化する前に、サイト上でカスタム投稿タイプ（例：[Woo Subscriptions](https://woocommerce.com/products/woocommerce-subscriptions/)、[WooCommerce Bookings](https://woocommerce.com/products/woocommerce-bookings/)など）を使用する拡張機能が有効化されていることを確認してください。注文データをHPOSに移行する前にこれらの拡張機能を無効化すると、データの不一致が生じる可能性があります。[HPOS移行時のカスタム投稿タイプの処理についてはこちら](https://woocommerce.com/document/high-performance-order-storage/#handling-custom-post-types-hpos)をご覧ください。

WooCommerce 8.2以降の**新規インストール**では、HPOSがデフォルトで有効になっています。既存のストアでは、以下の手順に従ってWordPress投稿ストレージから高パフォーマンス注文ストレージに切り替えることができます。

HPOS を有効にするには、まず既存のストアで投稿テーブルと注文テーブルの両方を同期する必要があります。

1. WP Admin で、**WooCommerce > 設定 > 詳細設定 > 機能** に移動します。
2. **互換モードを有効にする（注文を投稿テーブルに同期）** チェックボックスにチェックを入れます。
3. この設定を有効にすると、バックグラウンドアクションがスケジュールされます。
- `wc_schedule_pending_batch_process` アクションは、バックフィルが必要な注文があるかどうかを確認します。
- 注文がある場合は、別のアクション (`wc_run_batch_process`) をスケジュールし、これらの注文を投稿ストレージにバックフィルします。
- これらのアクションが自動的に実行されるのを待つこともできます（それほど時間はかかりません）。または、**WooCommerce > ステータス > スケジュールされたアクション** に移動してアクションを見つけ、アクション名の下の **実行** リンクをクリックします（マウスカーソルをアクション名の上に置くと表示されます）。
- このアクションは、**一度に 25 件の注文をバックフィルします**。同期する注文がさらにある場合は、前のアクションが完了すると、さらにアクションがスケジュールされます。
  
4. 両方のテーブルが正常に同期されたら、HPOS に切り替えるオプションを選択できます。
- スムーズな移行を実現するために、しばらくは互換モードを維持することをお勧めします。問題が発生した場合は、すぐに `_posts` テーブルに戻すことができます。
  

あるいは、コマンドラインインターフェース（CLI）コマンド「wp wc cot sync」を使用して、「_posts」テーブルからHPOSテーブルに注文をコピーすることもできます。このコマンドは、権限のあるテーブルの設定に基づいて、データ転送に適したテーブルを自動的に特定します。

**注:** [**互換モードを有効にする (注文を投稿テーブルに同期します)]** 設定をオフにしてからオンにすると、必要に応じてバックフィル プロセスが再度スケジュールされます。

データ ストアを自由に切り替えて、テーブル間でデータを同期できます。

- **WordPress 投稿ストレージ（レガシー）** オプションを選択した場合、システムは注文データを `_posts` テーブルと `_postmeta` テーブルに保存します。このシナリオでは注文テーブルは使用されません。

- **高パフォーマンス注文ストレージ（推奨）** オプションを選択すると、システムは新しい WooCommerce 注文テーブル内に注文データを保存します。

- **WordPress 投稿ストレージ (レガシー)** オプションを選択し、**互換モードを有効にする** チェックボックスをオンにすると、システムは `_posts`、`_postmeta`、および WooCommerce 注文テーブル間で注文データを同期します。

**高パフォーマンス注文ストレージ（推奨）**と**互換モード**の両方のオプションが選択されている場合、WooCommerceはHPOSテーブルに`_posts`テーブルと`_postmeta`テーブルのデータを入力します。[異なるテーブル間の同期について詳しくは、こちらをご覧ください](https://developer.woocommerce.com/2022/09/29/high-performance-order-storage-backward-compatibility-and-synchronization/#synchronization)。

高性能注文ストレージを有効にする前に、サイト上でカスタム投稿タイプ（例：[Woo Subscriptions](https://woocommerce.com/products/woocommerce-subscriptions/)、[WooCommerce Bookings](https://woocommerce.com/products/woocommerce-bookings/)など）を使用する拡張機能が有効になっていることを確認してください。これらの拡張機能は、WordPressの投稿テーブルにデータを保存します。HPOSを有効にすると、注文データは新しく最適化されたHPOSテーブルに移動されます。

移行後に拡張機能を再有効化すると、元のデータが投稿テーブルに残り、システムがHPOSテーブルを参照するようになったため認識されず、データの不一致が発生する可能性があります。**このような問題を防ぐには、HPOSを有効にする際に、カスタム投稿タイプを利用する拡張機能を有効化したままにしてください。**

拡張機能をすでに無効にして HPOS を有効にしている場合は、次の手順に従って注文データを正しく移行してください。

1. **WooCommerce > 設定 > 詳細 > 機能** に移動します。
2. **高パフォーマンス注文ストレージ** を **WordPress 投稿ストレージ** に切り替え、同期が完了するまで待ちます。
3. 次に、**高パフォーマンス注文ストレージ** に切り替えます。

HPOS と互換性のない拡張機能を使用している場合、WP Admin の **WooCommerce > 設定 > 詳細 > 機能** で切り替えオプションが無効になります。

- **[表示と管理]** リンクをクリックして、互換性のない拡張機能のリストを確認してください。
- `https://example.com/wp-admin/plugins.php?plugin_status=incompatible_with_feature&feature_id=custom_order_tables` にアクセスして、互換性のない拡張機能のリストを確認することもできます (`example.com` をサイトのドメインに置き換えてください)。

**注:** High-Performance Order Storage で正常に動作しないサードパーティ製拡張機能をご利用の場合は、開発者に連絡して HPOS サポートを追加するよう依頼してください。拡張機能に HPOS サポートを追加するかどうかは、各拡張機能開発者の責任です。開発者の皆様の統合作業を支援するために、[開発者向けリソースとドキュメント](https://developer.woocommerce.com/2022/09/14/high-performance-order-storage-progress-report/)をご用意しております。

WooCommerce 9.0 以降、注文の全文検索（FTS）が試験運用モードで利用可能になりました。この機能により検索機能が強化され、注文の住所と商品を使った迅速な検索が可能になります。

実験的な「HPOS全文検索インデックス」機能を有効にするには:

1. **WooCommerce > 設定 > 詳細 > 機能** に移動します。
2. **注文データストレージ** が HPOS に設定されていることを確認します。
3. **試験的機能** セクションで、**HPOS 全文検索インデックス** オプションを有効にします。

**注:** この機能は、**注文データの保存が HPOS に設定されている場合にのみ機能します**。

問題が発生した場合、またはまだ HPOS と互換性のない拡張機能を引き続き使用する必要がある場合は、**注文データ ストレージ** 設定を一時的に **WordPress 投稿ストレージ (レガシー)** に戻すことをお勧めします。

これを行うには、**WooCommerce > 設定 > 詳細 > 機能** に移動し、**互換モード** が有効になっていることを確認してください。まだ有効になっていない場合は、注文データがデータストア間で同期されるまでお待ちいただく必要があります。

同期が完了したら、**WordPress 投稿ストレージ（レガシー）** を優先オプションとして選択してください。この時点で互換モードを無効にすることもできます。HPOS を再度有効にする準備ができたら、[このドキュメントの冒頭](https://woocommerce.com/document/high-performance-order-storage/#section-3)に記載されている手順に従ってください。最後に、変更を加えた後はこのページを保存することを忘れないでください。

前述のとおり、互換性のない拡張機能についてはサポート チームに連絡して修正措置を講じることを強くお勧めします。

あなたやあなたのチームがストアのカスタム コード、拡張機能、または HPOS に関連するものを更新する必要がある場合は、[アップグレード レシピ ブック](https://developer.woocommerce.com/docs/features/high-performance-order-storage/recipe-book/) を参照して、すべての技術的な詳細を確認してください。

問題ありません！HPOSへの切り替えをお勧めしておりますが、お客様に迅速なチェックアウト体験を最大限ご活用いただくために、すぐにお試しになりたいとお考えでない方もいらっしゃるかもしれません。この機能は完全に**オプトイン**で、いつでも切り替え可能です。

今後のHPOSの変更については、開発者コミュニティに積極的に周知しています。ブログ記事、GitHubでの拡張機能の更新方法に関するガイド、そして詳細なドキュメントもご用意しています。拡張機能開発者の皆様にはHPOSへの移行を積極的に推奨しておりますが、一部の開発者はHPOSに対応していない場合があります。お使いの拡張機能がHPOSに対応していない場合は、それぞれの開発者のサポートチームにご連絡いただき、更新を依頼することを強くお勧めします。既にHPOSがインストールされている場合は、拡張機能をHPOSなしでも引き続きご利用いただけます。

あらゆる規模の企業が、高性能注文ストレージの恩恵を受けることができます。

既存の店舗はHPOSに自動的に移行されることはありません。この機能は完全にオプトイン方式です。上記の手順に従ってHPOSを有効化してください。

**ホスティングに関する制限はありません**。WordPressとWooCommerceが動作可能なホストであれば、HPOSを問題なく実行できます。HPOSを有効にすると、様々な点でパフォーマンスが向上するはずです。[WooCommerceのサーバー要件について詳しくはこちら](https://woocommerce.com/document/server-requirements/)。

技術的な詳細については、[開発者ブログの FAQ](https://developer.woocommerce.com/2022/10/11/hpos-upgrade-faqs/) をご覧ください。

まだ質問があり、サポートが必要ですか?

このドキュメントは、無料の[コア WooCommerce プラグイン](https://wordpress.org/plugins/woocommerce/)に関するものです。このプラグインのサポートは、[WordPress.org のコミュニティフォーラム](https://wordpress.org/support/plugin/woocommerce) で提供されています。このフォーラムを検索すると、同じ質問が過去に投稿され、回答されているケースがよくあります。フォーラムを利用するための WordPress.org アカウントをまだ作成していない場合は、[作成方法はこちら](https://make.wordpress.org/contribute/join/)をご覧ください。

- ここで紹介したコア機能を**拡張**したい場合は、[WooCommerce マーケットプレイス](https://woocommerce.com/products/)で利用可能な拡張機能をご確認ください。
- 継続的な高度なサポートや WooCommerce 向けの**カスタマイズ**が必要ですか？[Woo エージェンシー パートナー](https://woocommerce.com/customizations/)をご活用ください。
- 独自の WooCommerce 統合機能や拡張機能を開発している**開発者**ですか？[開発者向けリソース](https://developer.woocommerce.com/)をご確認ください。

必要な情報が見つからない場合は、下のフィードバック サムを使用してお知らせください。

